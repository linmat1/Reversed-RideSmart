{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import'./LyftBooker.css';import MapSelector from'./MapSelector';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const API_BASE=process.env.REACT_APP_API_URL||'http://localhost:5001';function LyftBooker(_ref){var _users$find2;let{onBack}=_ref;const[users,setUsers]=useState([]);const[routes,setRoutes]=useState([]);const[originalUser,setOriginalUser]=useState('');const[selectedRoute,setSelectedRoute]=useState('');const[searchMode,setSearchMode]=useState('map');// 'route' or 'map' - default to 'map'\nconst[mapOrigin,setMapOrigin]=useState(null);const[mapDestination,setMapDestination]=useState(null);const[mapSelectMode,setMapSelectMode]=useState('origin');// 'origin', 'destination', or 'none'\nconst[loading,setLoading]=useState(true);const[running,setRunning]=useState(false);const[result,setResult]=useState(null);const[log,setLog]=useState([]);const[activeBookings,setActiveBookings]=useState([]);// Track active bookings for manual cancellation\nconst[cancellingBooking,setCancellingBooking]=useState(null);const[gettingLocation,setGettingLocation]=useState(false);const[centerOnOrigin,setCenterOnOrigin]=useState(false);// Only center when using current location\nconst logEndRef=useRef(null);// Auto-scroll log to bottom\nuseEffect(()=>{if(logEndRef.current){logEndRef.current.scrollIntoView({behavior:'smooth'});}},[log]);// Fetch users and routes on mount\nuseEffect(()=>{const fetchData=async()=>{try{const[usersRes,routesRes]=await Promise.all([fetch(\"\".concat(API_BASE,\"/api/users\")),fetch(\"\".concat(API_BASE,\"/api/routes\"))]);if(usersRes.ok){const usersData=await usersRes.json();setUsers(usersData.users||[]);// Don't set default user - user must select\n}if(routesRes.ok){var _routesData$routes;const routesData=await routesRes.json();setRoutes(routesData.routes||[]);if(((_routesData$routes=routesData.routes)===null||_routesData$routes===void 0?void 0:_routesData$routes.length)>0){setSelectedRoute(routesData.routes[0].id);}}}catch(err){console.error('Error fetching data:',err);}finally{setLoading(false);}};fetchData();},[]);const runOrchestrator=async()=>{// Validate based on search mode\nif(!originalUser){alert('Please select an original person (who wants the lyft sent to)');return;}if(searchMode==='route'&&!selectedRoute){alert('Please select a route');return;}if(searchMode==='map'&&(!mapOrigin||!mapDestination)){alert('Please select both origin and destination on the map');return;}setRunning(true);setResult(null);setLog(['Starting Lyft Orchestrator...']);try{let requestBody={original_user:originalUser};if(searchMode==='route'){requestBody.route_id=selectedRoute;}else{// Map mode - send custom coordinates\nrequestBody.origin={latlng:{lat:mapOrigin.lat,lng:mapOrigin.lng},full_geocoded_addr:\"Custom Location (\".concat(mapOrigin.lat.toFixed(6),\", \").concat(mapOrigin.lng.toFixed(6),\")\"),geocoded_addr:\"(\".concat(mapOrigin.lat.toFixed(6),\", \").concat(mapOrigin.lng.toFixed(6),\")\")};requestBody.destination={latlng:{lat:mapDestination.lat,lng:mapDestination.lng},full_geocoded_addr:\"Custom Location (\".concat(mapDestination.lat.toFixed(6),\", \").concat(mapDestination.lng.toFixed(6),\")\"),geocoded_addr:\"(\".concat(mapDestination.lat.toFixed(6),\", \").concat(mapDestination.lng.toFixed(6),\")\")};}// Use fetch with ReadableStream for Server-Sent Events (live streaming)\nconst response=await fetch(\"\".concat(API_BASE,\"/api/lyft/run\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(requestBody)});if(!response.ok){throw new Error(\"HTTP error! status: \".concat(response.status));}if(!response.body){throw new Error('Response body is not available');}const reader=response.body.getReader();const decoder=new TextDecoder();let buffer='';while(true){const{done,value}=await reader.read();if(done){// Process any remaining buffer\nif(buffer.trim()){const lines=buffer.split('\\n');for(const line of lines){if(line.startsWith('data: ')){try{const data=JSON.parse(line.slice(6));if(data.type==='result'){setResult({success:data.data.success,message:data.data.message,booking:data.data.lyft_booking});setRunning(false);}else if(data.type==='error'){setResult({success:false,message:\"Error: \".concat(data.message)});setLog(prev=>[...prev,\"ERROR: \".concat(data.message)]);setRunning(false);}}catch(e){console.error('Error parsing final SSE data:',e);}}}}// If stream closed without result, treat as error\n// Check if we already have a result set\nconst hasResult=result!==null;if(!hasResult){setResult({success:false,message:'Connection closed unexpectedly. All rides have been cancelled on the server.'});setLog(prev=>[...prev,'ERROR: Connection closed unexpectedly']);setRunning(false);}break;}buffer+=decoder.decode(value,{stream:true});const lines=buffer.split('\\n');buffer=lines.pop()||'';// Keep incomplete line in buffer\nfor(const line of lines){if(line.trim()&&line.startsWith('data: ')){try{const data=JSON.parse(line.slice(6));if(data.type==='log'){setLog(prev=>[...prev,data.message]);// Extract booking information from logs to track active bookings\n// Look for patterns like \"‚úì {name} booked RideSmart (ride ID: {id})\" or \"Confirmed Ride ID: {id}\"\nconst bookingMatch=data.message.match(/‚úì\\s+([A-Za-z\\s]+?)\\s+booked\\s+(RideSmart|Lyft)[\\s!]*(?:\\(ride\\s+ID:\\s+(\\d+)\\)|Confirmed Ride ID:\\s+(\\d+))?/i);if(bookingMatch){const[,userName,rideType,rideId1,rideId2]=bookingMatch;const rideId=rideId1||rideId2;if(rideId){setActiveBookings(prev=>{// Avoid duplicates\nconst exists=prev.some(b=>b.ride_id===parseInt(rideId));if(!exists){return[...prev,{user_name:userName.trim(),ride_id:parseInt(rideId),ride_type:rideType}];}return prev;});}}// Remove cancelled bookings from active list\nconst cancelMatch=data.message.match(/‚úì\\s+Cancelled\\s+([A-Za-z\\s]+?)'s\\s+(?:booking|Lyft booking)/i);if(cancelMatch){const userName=cancelMatch[1].trim();setActiveBookings(prev=>prev.filter(b=>b.user_name!==userName));}}else if(data.type==='result'){setResult({success:data.data.success,message:data.data.message,booking:data.data.lyft_booking});// Extract final booking info if successful\nif(data.data.success&&data.data.lyft_booking){const rides=data.data.lyft_booking.prescheduled_recurring_series_rides;if(rides&&rides.length>0){var _users$find;const originalUserName=(_users$find=users.find(u=>u.id===originalUser))===null||_users$find===void 0?void 0:_users$find.name;setActiveBookings(prev=>[...prev,{user_name:originalUserName,ride_id:rides[0].id,ride_type:'Lyft'}]);}}setRunning(false);return;}else if(data.type==='error'){setResult({success:false,message:\"Error: \".concat(data.message)});setLog(prev=>[...prev,\"ERROR: \".concat(data.message)]);setRunning(false);return;}}catch(e){console.error('Error parsing SSE data:',e,'Line:',line);}}}}// setRunning(false) is already handled in the result/error handlers above\n}catch(err){// Network error or other exception\nsetResult({success:false,message:\"Connection error: \".concat(err.message,\". The server will cancel all rides automatically.\")});setLog(prev=>[...prev,\"ERROR: \".concat(err.message)]);setRunning(false);}};const getFillerAccounts=()=>{return users.filter(u=>u.id!==originalUser).map(u=>u.name);};const getCurrentLocation=()=>{if(!navigator.geolocation){alert('Geolocation is not supported by your browser');return;}setGettingLocation(true);navigator.geolocation.getCurrentPosition(position=>{const coords={lat:position.coords.latitude,lng:position.coords.longitude};setMapOrigin(coords);setMapSelectMode('destination');setCenterOnOrigin(true);// Trigger map centering only for current location\nsetGettingLocation(false);// Reset centerOnOrigin after a brief moment so it can be triggered again if needed\nsetTimeout(()=>setCenterOnOrigin(false),100);},error=>{setGettingLocation(false);let errorMessage='Unable to get your location. ';switch(error.code){case error.PERMISSION_DENIED:errorMessage+='Please allow location access in your browser settings.';break;case error.POSITION_UNAVAILABLE:errorMessage+='Location information is unavailable.';break;case error.TIMEOUT:errorMessage+='Location request timed out.';break;default:errorMessage+='An unknown error occurred.';break;}alert(errorMessage);},{enableHighAccuracy:true,timeout:10000,maximumAge:0});};const cancelIndividualBooking=async booking=>{setCancellingBooking(booking.ride_id);try{// Find the user key for this booking\nconst user=users.find(u=>u.name===booking.user_name);if(!user){alert(\"User \".concat(booking.user_name,\" not found\"));return;}const response=await fetch(\"\".concat(API_BASE,\"/api/lyft/cancel-booking\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({user_id:user.id,ride_id:booking.ride_id})});const data=await response.json();if(data.success){setActiveBookings(prev=>prev.filter(b=>b.ride_id!==booking.ride_id));setLog(prev=>[...prev,\"\\u2713 \".concat(data.message)]);alert(\"Successfully cancelled \".concat(booking.user_name,\"'s \").concat(booking.ride_type,\" booking\"));}else{alert(\"Failed to cancel booking: \".concat(data.message||'Unknown error'));}}catch(err){alert(\"Error cancelling booking: \".concat(err.message));}finally{setCancellingBooking(null);}};if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"lyft-booker\",children:/*#__PURE__*/_jsx(\"div\",{className:\"loading\",children:\"Loading...\"})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"lyft-booker\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"lyft-header\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\uD83D\\uDE97 Lyft Booker\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Get free Lyft rides by filling RideSmart capacity\"})]}),!running&&!result&&!log.length&&/*#__PURE__*/_jsxs(\"div\",{className:\"lyft-setup\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"setup-section\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"\\uD83D\\uDC64 Original Person (who wants the lyft sent to):\"}),/*#__PURE__*/_jsxs(\"select\",{value:originalUser,onChange:e=>setOriginalUser(e.target.value),className:\"lyft-select\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"-- Select a person --\"}),users.map(user=>/*#__PURE__*/_jsx(\"option\",{value:user.id,children:user.name},user.id))]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"setup-section\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"\\uD83D\\uDCCD Route Selection:\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"search-mode-toggle\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"mode-toggle-btn \".concat(searchMode==='map'?'active':''),onClick:()=>{setSearchMode('map');setMapOrigin(null);setMapDestination(null);setMapSelectMode('origin');},children:\"Use Map\"}),/*#__PURE__*/_jsx(\"button\",{className:\"mode-toggle-btn \".concat(searchMode==='route'?'active':''),onClick:()=>{setSearchMode('route');setMapOrigin(null);setMapDestination(null);setMapSelectMode('origin');},children:\"Use Route\"})]})]}),searchMode==='route'?/*#__PURE__*/_jsxs(\"div\",{className:\"setup-section\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"\\uD83D\\uDCCD Select Route:\"}),/*#__PURE__*/_jsx(\"select\",{value:selectedRoute,onChange:e=>setSelectedRoute(e.target.value),className:\"lyft-select\",children:routes.map(route=>/*#__PURE__*/_jsxs(\"option\",{value:route.id,children:[route.origin.name,\" \\u2192 \",route.destination.name]},route.id))})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"setup-section\",children:/*#__PURE__*/_jsx(\"div\",{className:\"map-controls\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"map-buttons\",children:[/*#__PURE__*/_jsxs(\"button\",{className:\"map-current-location-btn\",onClick:getCurrentLocation,disabled:gettingLocation,title:\"Use your current location as origin\",children:[/*#__PURE__*/_jsxs(\"svg\",{width:\"16\",height:\"16\",viewBox:\"0 0 16 16\",fill:\"none\",xmlns:\"http://www.w3.org/2000/svg\",children:[/*#__PURE__*/_jsx(\"circle\",{cx:\"8\",cy:\"8\",r:\"4\",fill:\"currentColor\"}),/*#__PURE__*/_jsx(\"rect\",{x:\"7\",y:\"2\",width:\"2\",height:\"2\",fill:\"currentColor\"}),/*#__PURE__*/_jsx(\"rect\",{x:\"7\",y:\"12\",width:\"2\",height:\"2\",fill:\"currentColor\"}),/*#__PURE__*/_jsx(\"rect\",{x:\"2\",y:\"7\",width:\"2\",height:\"2\",fill:\"currentColor\"}),/*#__PURE__*/_jsx(\"rect\",{x:\"12\",y:\"7\",width:\"2\",height:\"2\",fill:\"currentColor\"})]}),/*#__PURE__*/_jsxs(\"span\",{className:\"current-location-text\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Use current\"}),/*#__PURE__*/_jsx(\"span\",{children:\"location\"})]})]}),/*#__PURE__*/_jsx(\"button\",{className:\"map-select-btn \".concat(mapSelectMode==='origin'?'active':''),onClick:()=>setMapSelectMode('origin'),disabled:!mapOrigin&&mapSelectMode!=='origin',children:mapOrigin?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\u2713 Origin\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Set\"})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"span\",{children:\"Set\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Origin\"})]})}),/*#__PURE__*/_jsx(\"button\",{className:\"map-select-btn \".concat(mapSelectMode==='destination'?'active':''),onClick:()=>setMapSelectMode('destination'),disabled:!mapDestination&&mapSelectMode!=='destination',children:mapDestination?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\u2713 Destination\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Set\"})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"span\",{children:\"Set\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Destination\"})]})}),/*#__PURE__*/_jsx(\"button\",{className:\"map-clear-btn\",onClick:()=>{setMapOrigin(null);setMapDestination(null);setMapSelectMode('origin');},disabled:!mapOrigin&&!mapDestination,title:\"Clear all selected locations\",children:\"Clear All\"})]})})}),/*#__PURE__*/_jsx(\"div\",{className:\"setup-section\",children:/*#__PURE__*/_jsx(MapSelector,{origin:mapOrigin,destination:mapDestination,onOriginSelect:coords=>{setMapOrigin(coords);setMapSelectMode('destination');setCenterOnOrigin(false);// Don't center when manually clicking\n},onDestinationSelect:coords=>{setMapDestination(coords);setMapSelectMode('none');},selectMode:mapSelectMode,centerOnOrigin:centerOnOrigin})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"setup-info\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Configuration\"}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Original User:\"}),\" \",((_users$find2=users.find(u=>u.id===originalUser))===null||_users$find2===void 0?void 0:_users$find2.name)||'None']}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Filler Accounts:\"}),\" \",getFillerAccounts().join(', ')||'None']}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Total Accounts:\"}),\" \",users.length]})]}),users.length<2&&/*#__PURE__*/_jsxs(\"div\",{className:\"warning-message\",children:[\"\\u26A0\\uFE0F You need at least 2 accounts to use the Lyft Booker. Add more users in \",/*#__PURE__*/_jsx(\"code\",{children:\"backend/src/users.py\"})]}),/*#__PURE__*/_jsx(\"button\",{className:\"start-button\",onClick:runOrchestrator,disabled:!originalUser||users.length<2||searchMode==='route'&&!selectedRoute||searchMode==='map'&&(!mapOrigin||!mapDestination),children:\"\\uD83D\\uDE80 Start Lyft Orchestrator\"})]}),(running||log.length>0)&&/*#__PURE__*/_jsxs(\"div\",{className:\"lyft-log\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\uD83D\\uDCCB Log\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"log-container\",children:[log.map((entry,index)=>/*#__PURE__*/_jsx(\"div\",{className:\"log-entry \".concat(entry.includes('SUCCESS')?'success':entry.includes('ERROR')||entry.includes('FAILED')||entry.includes('‚úó')?'error':entry.includes('‚úì')?'success':entry.includes('---')?'section':''),children:entry},index)),running&&/*#__PURE__*/_jsx(\"div\",{className:\"log-entry running\",children:\"\\u23F3 Running...\"}),/*#__PURE__*/_jsx(\"div\",{ref:logEndRef})]})]}),activeBookings.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"active-bookings-section\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\uD83D\\uDCCB Active Bookings\"}),/*#__PURE__*/_jsx(\"p\",{className:\"bookings-subtitle\",children:\"Manage individual bookings (filler bookings should be automatically cancelled on success)\"}),/*#__PURE__*/_jsx(\"div\",{className:\"bookings-list\",children:activeBookings.map((booking,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"booking-item\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"booking-info\",children:[/*#__PURE__*/_jsx(\"strong\",{children:booking.user_name}),/*#__PURE__*/_jsx(\"span\",{className:\"booking-type\",children:booking.ride_type}),/*#__PURE__*/_jsxs(\"span\",{className:\"booking-id\",children:[\"Ride ID: \",booking.ride_id]})]}),/*#__PURE__*/_jsx(\"button\",{className:\"cancel-booking-btn\",onClick:()=>cancelIndividualBooking(booking),disabled:cancellingBooking===booking.ride_id,children:cancellingBooking===booking.ride_id?'Cancelling...':'Cancel'})]},index))})]}),result&&/*#__PURE__*/_jsxs(\"div\",{className:\"lyft-result \".concat(result.success?'success':'failed'),children:[/*#__PURE__*/_jsx(\"h2\",{children:result.success?'üéâ SUCCESS!':'‚ùå FAILED'}),/*#__PURE__*/_jsx(\"p\",{children:result.message}),result.success&&result.booking&&/*#__PURE__*/_jsxs(\"div\",{className:\"booking-details\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Booking Details\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Your Lyft has been booked!\"}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\uD83D\\uDCF1 Check your phone\"}),\" - the Lyft will be sent there\"]})]}),/*#__PURE__*/_jsx(\"button\",{className:\"reset-button\",onClick:()=>{setResult(null);setLog([]);setActiveBookings([]);},children:\"Try Again\"})]})]});}export default LyftBooker;","map":{"version":3,"names":["React","useState","useEffect","useRef","MapSelector","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","API_BASE","process","env","REACT_APP_API_URL","LyftBooker","_ref","_users$find2","onBack","users","setUsers","routes","setRoutes","originalUser","setOriginalUser","selectedRoute","setSelectedRoute","searchMode","setSearchMode","mapOrigin","setMapOrigin","mapDestination","setMapDestination","mapSelectMode","setMapSelectMode","loading","setLoading","running","setRunning","result","setResult","log","setLog","activeBookings","setActiveBookings","cancellingBooking","setCancellingBooking","gettingLocation","setGettingLocation","centerOnOrigin","setCenterOnOrigin","logEndRef","current","scrollIntoView","behavior","fetchData","usersRes","routesRes","Promise","all","fetch","concat","ok","usersData","json","_routesData$routes","routesData","length","id","err","console","error","runOrchestrator","alert","requestBody","original_user","route_id","origin","latlng","lat","lng","full_geocoded_addr","toFixed","geocoded_addr","destination","response","method","headers","body","JSON","stringify","Error","status","reader","getReader","decoder","TextDecoder","buffer","done","value","read","trim","lines","split","line","startsWith","data","parse","slice","type","success","message","booking","lyft_booking","prev","e","hasResult","decode","stream","pop","bookingMatch","match","userName","rideType","rideId1","rideId2","rideId","exists","some","b","ride_id","parseInt","user_name","ride_type","cancelMatch","filter","rides","prescheduled_recurring_series_rides","_users$find","originalUserName","find","u","name","getFillerAccounts","map","getCurrentLocation","navigator","geolocation","getCurrentPosition","position","coords","latitude","longitude","setTimeout","errorMessage","code","PERMISSION_DENIED","POSITION_UNAVAILABLE","TIMEOUT","enableHighAccuracy","timeout","maximumAge","cancelIndividualBooking","user","user_id","className","children","onChange","target","onClick","route","disabled","title","width","height","viewBox","fill","xmlns","cx","cy","r","x","y","onOriginSelect","onDestinationSelect","selectMode","join","entry","index","includes","ref"],"sources":["/Users/linmat/Documents/GitHub/Reversed-RideSmart/frontend/src/LyftBooker.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport './LyftBooker.css';\nimport MapSelector from './MapSelector';\n\nconst API_BASE = process.env.REACT_APP_API_URL || 'http://localhost:5001';\n\nfunction LyftBooker({ onBack }) {\n  const [users, setUsers] = useState([]);\n  const [routes, setRoutes] = useState([]);\n  const [originalUser, setOriginalUser] = useState('');\n  const [selectedRoute, setSelectedRoute] = useState('');\n  const [searchMode, setSearchMode] = useState('map'); // 'route' or 'map' - default to 'map'\n  const [mapOrigin, setMapOrigin] = useState(null);\n  const [mapDestination, setMapDestination] = useState(null);\n  const [mapSelectMode, setMapSelectMode] = useState('origin'); // 'origin', 'destination', or 'none'\n  const [loading, setLoading] = useState(true);\n  const [running, setRunning] = useState(false);\n  const [result, setResult] = useState(null);\n  const [log, setLog] = useState([]);\n  const [activeBookings, setActiveBookings] = useState([]); // Track active bookings for manual cancellation\n  const [cancellingBooking, setCancellingBooking] = useState(null);\n  const [gettingLocation, setGettingLocation] = useState(false);\n  const [centerOnOrigin, setCenterOnOrigin] = useState(false); // Only center when using current location\n  const logEndRef = useRef(null);\n\n  // Auto-scroll log to bottom\n  useEffect(() => {\n    if (logEndRef.current) {\n      logEndRef.current.scrollIntoView({ behavior: 'smooth' });\n    }\n  }, [log]);\n\n  // Fetch users and routes on mount\n  useEffect(() => {\n    const fetchData = async () => {\n      try {\n        const [usersRes, routesRes] = await Promise.all([\n          fetch(`${API_BASE}/api/users`),\n          fetch(`${API_BASE}/api/routes`)\n        ]);\n\n        if (usersRes.ok) {\n          const usersData = await usersRes.json();\n          setUsers(usersData.users || []);\n          // Don't set default user - user must select\n        }\n\n        if (routesRes.ok) {\n          const routesData = await routesRes.json();\n          setRoutes(routesData.routes || []);\n          if (routesData.routes?.length > 0) {\n            setSelectedRoute(routesData.routes[0].id);\n          }\n        }\n      } catch (err) {\n        console.error('Error fetching data:', err);\n      } finally {\n        setLoading(false);\n      }\n    };\n    fetchData();\n  }, []);\n\n  const runOrchestrator = async () => {\n    // Validate based on search mode\n    if (!originalUser) {\n      alert('Please select an original person (who wants the lyft sent to)');\n      return;\n    }\n\n    if (searchMode === 'route' && !selectedRoute) {\n      alert('Please select a route');\n      return;\n    }\n\n    if (searchMode === 'map' && (!mapOrigin || !mapDestination)) {\n      alert('Please select both origin and destination on the map');\n      return;\n    }\n\n    setRunning(true);\n    setResult(null);\n    setLog(['Starting Lyft Orchestrator...']);\n\n    try {\n      let requestBody = {\n        original_user: originalUser\n      };\n\n      if (searchMode === 'route') {\n        requestBody.route_id = selectedRoute;\n      } else {\n        // Map mode - send custom coordinates\n        requestBody.origin = {\n          latlng: {\n            lat: mapOrigin.lat,\n            lng: mapOrigin.lng\n          },\n          full_geocoded_addr: `Custom Location (${mapOrigin.lat.toFixed(6)}, ${mapOrigin.lng.toFixed(6)})`,\n          geocoded_addr: `(${mapOrigin.lat.toFixed(6)}, ${mapOrigin.lng.toFixed(6)})`\n        };\n        requestBody.destination = {\n          latlng: {\n            lat: mapDestination.lat,\n            lng: mapDestination.lng\n          },\n          full_geocoded_addr: `Custom Location (${mapDestination.lat.toFixed(6)}, ${mapDestination.lng.toFixed(6)})`,\n          geocoded_addr: `(${mapDestination.lat.toFixed(6)}, ${mapDestination.lng.toFixed(6)})`\n        };\n      }\n\n      // Use fetch with ReadableStream for Server-Sent Events (live streaming)\n      const response = await fetch(`${API_BASE}/api/lyft/run`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(requestBody)\n      });\n\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n\n      if (!response.body) {\n        throw new Error('Response body is not available');\n      }\n\n      const reader = response.body.getReader();\n      const decoder = new TextDecoder();\n      let buffer = '';\n\n      while (true) {\n        const { done, value } = await reader.read();\n        \n        if (done) {\n          // Process any remaining buffer\n          if (buffer.trim()) {\n            const lines = buffer.split('\\n');\n            for (const line of lines) {\n              if (line.startsWith('data: ')) {\n                try {\n                  const data = JSON.parse(line.slice(6));\n                  if (data.type === 'result') {\n                    setResult({\n                      success: data.data.success,\n                      message: data.data.message,\n                      booking: data.data.lyft_booking\n                    });\n                    setRunning(false);\n                  } else if (data.type === 'error') {\n                    setResult({\n                      success: false,\n                      message: `Error: ${data.message}`\n                    });\n                    setLog(prev => [...prev, `ERROR: ${data.message}`]);\n                    setRunning(false);\n                  }\n                } catch (e) {\n                  console.error('Error parsing final SSE data:', e);\n                }\n              }\n            }\n          }\n          // If stream closed without result, treat as error\n          // Check if we already have a result set\n          const hasResult = result !== null;\n          if (!hasResult) {\n            setResult({\n              success: false,\n              message: 'Connection closed unexpectedly. All rides have been cancelled on the server.'\n            });\n            setLog(prev => [...prev, 'ERROR: Connection closed unexpectedly']);\n            setRunning(false);\n          }\n          break;\n        }\n\n        buffer += decoder.decode(value, { stream: true });\n        const lines = buffer.split('\\n');\n        buffer = lines.pop() || ''; // Keep incomplete line in buffer\n\n        for (const line of lines) {\n          if (line.trim() && line.startsWith('data: ')) {\n            try {\n              const data = JSON.parse(line.slice(6));\n              \n              if (data.type === 'log') {\n                setLog(prev => [...prev, data.message]);\n                \n                // Extract booking information from logs to track active bookings\n                // Look for patterns like \"‚úì {name} booked RideSmart (ride ID: {id})\" or \"Confirmed Ride ID: {id}\"\n                const bookingMatch = data.message.match(/‚úì\\s+([A-Za-z\\s]+?)\\s+booked\\s+(RideSmart|Lyft)[\\s!]*(?:\\(ride\\s+ID:\\s+(\\d+)\\)|Confirmed Ride ID:\\s+(\\d+))?/i);\n                if (bookingMatch) {\n                  const [, userName, rideType, rideId1, rideId2] = bookingMatch;\n                  const rideId = rideId1 || rideId2;\n                  if (rideId) {\n                    setActiveBookings(prev => {\n                      // Avoid duplicates\n                      const exists = prev.some(b => b.ride_id === parseInt(rideId));\n                      if (!exists) {\n                        return [...prev, {\n                          user_name: userName.trim(),\n                          ride_id: parseInt(rideId),\n                          ride_type: rideType\n                        }];\n                      }\n                      return prev;\n                    });\n                  }\n                }\n                \n                // Remove cancelled bookings from active list\n                const cancelMatch = data.message.match(/‚úì\\s+Cancelled\\s+([A-Za-z\\s]+?)'s\\s+(?:booking|Lyft booking)/i);\n                if (cancelMatch) {\n                  const userName = cancelMatch[1].trim();\n                  setActiveBookings(prev => prev.filter(b => b.user_name !== userName));\n                }\n              } else if (data.type === 'result') {\n                setResult({\n                  success: data.data.success,\n                  message: data.data.message,\n                  booking: data.data.lyft_booking\n                });\n                \n                // Extract final booking info if successful\n                if (data.data.success && data.data.lyft_booking) {\n                  const rides = data.data.lyft_booking.prescheduled_recurring_series_rides;\n                  if (rides && rides.length > 0) {\n                    const originalUserName = users.find(u => u.id === originalUser)?.name;\n                    setActiveBookings(prev => [...prev, {\n                      user_name: originalUserName,\n                      ride_id: rides[0].id,\n                      ride_type: 'Lyft'\n                    }]);\n                  }\n                }\n                \n                setRunning(false);\n                return;\n              } else if (data.type === 'error') {\n                setResult({\n                  success: false,\n                  message: `Error: ${data.message}`\n                });\n                setLog(prev => [...prev, `ERROR: ${data.message}`]);\n                setRunning(false);\n                return;\n              }\n            } catch (e) {\n              console.error('Error parsing SSE data:', e, 'Line:', line);\n            }\n          }\n        }\n      }\n      \n      // setRunning(false) is already handled in the result/error handlers above\n    } catch (err) {\n      // Network error or other exception\n      setResult({\n        success: false,\n        message: `Connection error: ${err.message}. The server will cancel all rides automatically.`\n      });\n      setLog(prev => [...prev, `ERROR: ${err.message}`]);\n      setRunning(false);\n    }\n  };\n\n  const getFillerAccounts = () => {\n    return users.filter(u => u.id !== originalUser).map(u => u.name);\n  };\n\n  const getCurrentLocation = () => {\n    if (!navigator.geolocation) {\n      alert('Geolocation is not supported by your browser');\n      return;\n    }\n\n    setGettingLocation(true);\n    navigator.geolocation.getCurrentPosition(\n      (position) => {\n        const coords = {\n          lat: position.coords.latitude,\n          lng: position.coords.longitude\n        };\n        setMapOrigin(coords);\n        setMapSelectMode('destination');\n        setCenterOnOrigin(true); // Trigger map centering only for current location\n        setGettingLocation(false);\n        // Reset centerOnOrigin after a brief moment so it can be triggered again if needed\n        setTimeout(() => setCenterOnOrigin(false), 100);\n      },\n      (error) => {\n        setGettingLocation(false);\n        let errorMessage = 'Unable to get your location. ';\n        switch (error.code) {\n          case error.PERMISSION_DENIED:\n            errorMessage += 'Please allow location access in your browser settings.';\n            break;\n          case error.POSITION_UNAVAILABLE:\n            errorMessage += 'Location information is unavailable.';\n            break;\n          case error.TIMEOUT:\n            errorMessage += 'Location request timed out.';\n            break;\n          default:\n            errorMessage += 'An unknown error occurred.';\n            break;\n        }\n        alert(errorMessage);\n      },\n      {\n        enableHighAccuracy: true,\n        timeout: 10000,\n        maximumAge: 0\n      }\n    );\n  };\n\n  const cancelIndividualBooking = async (booking) => {\n    setCancellingBooking(booking.ride_id);\n    \n    try {\n      // Find the user key for this booking\n      const user = users.find(u => u.name === booking.user_name);\n      if (!user) {\n        alert(`User ${booking.user_name} not found`);\n        return;\n      }\n\n      const response = await fetch(`${API_BASE}/api/lyft/cancel-booking`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          user_id: user.id,\n          ride_id: booking.ride_id\n        })\n      });\n\n      const data = await response.json();\n      \n      if (data.success) {\n        setActiveBookings(prev => prev.filter(b => b.ride_id !== booking.ride_id));\n        setLog(prev => [...prev, `‚úì ${data.message}`]);\n        alert(`Successfully cancelled ${booking.user_name}'s ${booking.ride_type} booking`);\n      } else {\n        alert(`Failed to cancel booking: ${data.message || 'Unknown error'}`);\n      }\n    } catch (err) {\n      alert(`Error cancelling booking: ${err.message}`);\n    } finally {\n      setCancellingBooking(null);\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"lyft-booker\">\n        <div className=\"loading\">Loading...</div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"lyft-booker\">\n      <div className=\"lyft-header\">\n        <h1>üöó Lyft Booker</h1>\n        <p>Get free Lyft rides by filling RideSmart capacity</p>\n      </div>\n\n      {!running && !result && !log.length && (\n        <div className=\"lyft-setup\">\n          <div className=\"setup-section\">\n            <label>üë§ Original Person (who wants the lyft sent to):</label>\n            <select \n              value={originalUser} \n              onChange={(e) => setOriginalUser(e.target.value)}\n              className=\"lyft-select\"\n            >\n              <option value=\"\">-- Select a person --</option>\n              {users.map(user => (\n                <option key={user.id} value={user.id}>{user.name}</option>\n              ))}\n            </select>\n          </div>\n\n          <div className=\"setup-section\">\n            <label>üìç Route Selection:</label>\n            <div className=\"search-mode-toggle\">\n              <button\n                className={`mode-toggle-btn ${searchMode === 'map' ? 'active' : ''}`}\n                onClick={() => {\n                  setSearchMode('map');\n                  setMapOrigin(null);\n                  setMapDestination(null);\n                  setMapSelectMode('origin');\n                }}\n              >\n                Use Map\n              </button>\n              <button\n                className={`mode-toggle-btn ${searchMode === 'route' ? 'active' : ''}`}\n                onClick={() => {\n                  setSearchMode('route');\n                  setMapOrigin(null);\n                  setMapDestination(null);\n                  setMapSelectMode('origin');\n                }}\n              >\n                Use Route\n              </button>\n            </div>\n          </div>\n\n          {searchMode === 'route' ? (\n            <div className=\"setup-section\">\n              <label>üìç Select Route:</label>\n              <select \n                value={selectedRoute} \n                onChange={(e) => setSelectedRoute(e.target.value)}\n                className=\"lyft-select\"\n              >\n                {routes.map(route => (\n                  <option key={route.id} value={route.id}>\n                    {route.origin.name} ‚Üí {route.destination.name}\n                  </option>\n                ))}\n              </select>\n            </div>\n          ) : (\n            <>\n              <div className=\"setup-section\">\n                <div className=\"map-controls\">\n                  <div className=\"map-buttons\">\n                    <button\n                      className=\"map-current-location-btn\"\n                      onClick={getCurrentLocation}\n                      disabled={gettingLocation}\n                      title=\"Use your current location as origin\"\n                    >\n                      <svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                        <circle cx=\"8\" cy=\"8\" r=\"4\" fill=\"currentColor\"/>\n                        <rect x=\"7\" y=\"2\" width=\"2\" height=\"2\" fill=\"currentColor\"/>\n                        <rect x=\"7\" y=\"12\" width=\"2\" height=\"2\" fill=\"currentColor\"/>\n                        <rect x=\"2\" y=\"7\" width=\"2\" height=\"2\" fill=\"currentColor\"/>\n                        <rect x=\"12\" y=\"7\" width=\"2\" height=\"2\" fill=\"currentColor\"/>\n                      </svg>\n                      <span className=\"current-location-text\">\n                        <span>Use current</span>\n                        <span>location</span>\n                      </span>\n                    </button>\n                    <button\n                      className={`map-select-btn ${mapSelectMode === 'origin' ? 'active' : ''}`}\n                      onClick={() => setMapSelectMode('origin')}\n                      disabled={!mapOrigin && mapSelectMode !== 'origin'}\n                    >\n                      {mapOrigin ? (\n                        <>\n                          <span>‚úì Origin</span>\n                          <span>Set</span>\n                        </>\n                      ) : (\n                        <>\n                          <span>Set</span>\n                          <span>Origin</span>\n                        </>\n                      )}\n                    </button>\n                    <button\n                      className={`map-select-btn ${mapSelectMode === 'destination' ? 'active' : ''}`}\n                      onClick={() => setMapSelectMode('destination')}\n                      disabled={!mapDestination && mapSelectMode !== 'destination'}\n                    >\n                      {mapDestination ? (\n                        <>\n                          <span>‚úì Destination</span>\n                          <span>Set</span>\n                        </>\n                      ) : (\n                        <>\n                          <span>Set</span>\n                          <span>Destination</span>\n                        </>\n                      )}\n                    </button>\n                    <button\n                      className=\"map-clear-btn\"\n                      onClick={() => {\n                        setMapOrigin(null);\n                        setMapDestination(null);\n                        setMapSelectMode('origin');\n                      }}\n                      disabled={!mapOrigin && !mapDestination}\n                      title=\"Clear all selected locations\"\n                    >\n                      Clear All\n                    </button>\n                  </div>\n                </div>\n              </div>\n              <div className=\"setup-section\">\n                <MapSelector\n                  origin={mapOrigin}\n                  destination={mapDestination}\n                  onOriginSelect={(coords) => {\n                    setMapOrigin(coords);\n                    setMapSelectMode('destination');\n                    setCenterOnOrigin(false); // Don't center when manually clicking\n                  }}\n                  onDestinationSelect={(coords) => {\n                    setMapDestination(coords);\n                    setMapSelectMode('none');\n                  }}\n                  selectMode={mapSelectMode}\n                  centerOnOrigin={centerOnOrigin}\n                />\n              </div>\n            </>\n          )}\n\n          <div className=\"setup-info\">\n            <h3>Configuration</h3>\n            <p><strong>Original User:</strong> {users.find(u => u.id === originalUser)?.name || 'None'}</p>\n            <p><strong>Filler Accounts:</strong> {getFillerAccounts().join(', ') || 'None'}</p>\n            <p><strong>Total Accounts:</strong> {users.length}</p>\n          </div>\n\n          {users.length < 2 && (\n            <div className=\"warning-message\">\n              ‚ö†Ô∏è You need at least 2 accounts to use the Lyft Booker.\n              Add more users in <code>backend/src/users.py</code>\n            </div>\n          )}\n\n          <button \n            className=\"start-button\"\n            onClick={runOrchestrator}\n            disabled={\n              !originalUser ||\n              users.length < 2 ||\n              (searchMode === 'route' && !selectedRoute) ||\n              (searchMode === 'map' && (!mapOrigin || !mapDestination))\n            }\n          >\n            üöÄ Start Lyft Orchestrator\n          </button>\n        </div>\n      )}\n\n      {(running || log.length > 0) && (\n        <div className=\"lyft-log\">\n          <h3>üìã Log</h3>\n          <div className=\"log-container\">\n            {log.map((entry, index) => (\n              <div \n                key={index} \n                className={`log-entry ${\n                  entry.includes('SUCCESS') ? 'success' : \n                  entry.includes('ERROR') || entry.includes('FAILED') || entry.includes('‚úó') ? 'error' :\n                  entry.includes('‚úì') ? 'success' :\n                  entry.includes('---') ? 'section' : ''\n                }`}\n              >\n                {entry}\n              </div>\n            ))}\n            {running && <div className=\"log-entry running\">‚è≥ Running...</div>}\n            <div ref={logEndRef} />\n          </div>\n        </div>\n      )}\n\n      {/* Active Bookings Section */}\n      {activeBookings.length > 0 && (\n        <div className=\"active-bookings-section\">\n          <h3>üìã Active Bookings</h3>\n          <p className=\"bookings-subtitle\">Manage individual bookings (filler bookings should be automatically cancelled on success)</p>\n          <div className=\"bookings-list\">\n            {activeBookings.map((booking, index) => (\n              <div key={index} className=\"booking-item\">\n                <div className=\"booking-info\">\n                  <strong>{booking.user_name}</strong>\n                  <span className=\"booking-type\">{booking.ride_type}</span>\n                  <span className=\"booking-id\">Ride ID: {booking.ride_id}</span>\n                </div>\n                <button\n                  className=\"cancel-booking-btn\"\n                  onClick={() => cancelIndividualBooking(booking)}\n                  disabled={cancellingBooking === booking.ride_id}\n                >\n                  {cancellingBooking === booking.ride_id ? 'Cancelling...' : 'Cancel'}\n                </button>\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {result && (\n        <div className={`lyft-result ${result.success ? 'success' : 'failed'}`}>\n          <h2>{result.success ? 'üéâ SUCCESS!' : '‚ùå FAILED'}</h2>\n          <p>{result.message}</p>\n          \n          {result.success && result.booking && (\n            <div className=\"booking-details\">\n              <h4>Booking Details</h4>\n              <p>Your Lyft has been booked!</p>\n              <p><strong>üì± Check your phone</strong> - the Lyft will be sent there</p>\n            </div>\n          )}\n\n          <button className=\"reset-button\" onClick={() => {\n            setResult(null);\n            setLog([]);\n            setActiveBookings([]);\n          }}>\n            Try Again\n          </button>\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default LyftBooker;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}